\nclass MinesweeperGame extends HTMLElement {\n    constructor() {\n        super();\n        this.attachShadow({ mode: 'open' });\n        this.difficulty = 'easy';\n        this.newGame();\n    }\n\n    newGame() {\n        this.setDifficulty(this.difficulty);\n        this.render();\n        this.initGame();\n    }\n\n    setDifficulty(difficulty) {\n        this.difficulty = difficulty;\n        const settings = {\n            easy: { rows: 9, cols: 9, mines: 10 },\n            medium: { rows: 16, cols: 16, mines: 40 },\n            hard: { rows: 16, cols: 30, mines: 99 },\n        };\n        Object.assign(this, settings[difficulty]);\n    }\n\n    render() {\n        this.shadowRoot.innerHTML = `\n            <style>\n                :host {\n                    display: grid;\n                    grid-template-columns: repeat(${this.cols}, 30px);\n                }\n                .cell {\n                    width: 30px;\n                    height: 30px;\n                    border: 1px solid var(--border-color, #ccc);\n                    background-color: var(--cell-bg-color, #e0e0e0);\n                    display: flex;\n                    justify-content: center;\n                    align-items: center;\n                    cursor: pointer;\n                }\n                .cell.revealed {\n                    background-color: var(--cell-revealed-bg-color, #f0f0f0);\n                }\n                .cell.mine {\n                    background-color: var(--mine-color, #ff0000);\n                }\n                @media (max-width: 600px) {\n                    :host {\n                        grid-template-columns: repeat(${this.cols}, 25px);\n                    }\n                    .cell {\n                        width: 25px;\n                        height: 25px;\n                    }\n                }\n            </style>\n        `;\n        for (let i = 0; i < this.rows * this.cols; i++) {\n            const cell = document.createElement('div');\n            cell.classList.add('cell');\n            cell.dataset.index = i;\n            this.shadowRoot.appendChild(cell);\n        }\n    }\n\n    initGame() {\n        this.board = Array(this.rows * this.cols).fill(0);\n        this.placeMines();\n        this.calculateNumbers();\n        this.addEventListeners();\n        this.revealedCount = 0;\n        this.gameOver = false;\n    }\n\n    placeMines() {\n        let minesPlaced = 0;\n        while (minesPlaced < this.mines) {\n            const index = Math.floor(Math.random() * this.board.length);\n            if (this.board[index] !== 'm') {\n                this.board[index] = 'm';\n                minesPlaced++;\n            }\n        }\n    }\n\n    calculateNumbers() {\n        for (let i = 0; i < this.board.length; i++) {\n            if (this.board[i] === 'm') continue;\n            let count = 0;\n            this.getNeighbors(i).forEach(neighbor => {\n                if (this.board[neighbor] === 'm') {\n                    count++;\n                }\n            });\n            this.board[i] = count;\n        }\n    }\n\n    getNeighbors(index) {\n        const neighbors = [];\n        const row = Math.floor(index / this.cols);\n        const col = index % this.cols;\n        for (let r = -1; r <= 1; r++) {\n            for (let c = -1; c <= 1; c++) {\n                if (r === 0 && c === 0) continue;\n                const newRow = row + r;\n                const newCol = col + c;\n                if (newRow >= 0 && newRow < this.rows && newCol >= 0 && newCol < this.cols) {\n                    neighbors.push(newRow * this.cols + newCol);\n                }\n            }\n        }\n        return neighbors;\n    }\n\n    addEventListeners() {\n        this.shadowRoot.querySelectorAll('.cell').forEach(cell => {\n            cell.addEventListener('click', () => this.revealCell(cell));\n            cell.addEventListener('contextmenu', (e) => {\n                e.preventDefault();\n                this.toggleFlag(cell);\n            });\n        });\n    }\n\n    revealCell(cell) {\n        if (this.gameOver || cell.classList.contains('revealed') || cell.classList.contains('flag')) return;\n        const index = parseInt(cell.dataset.index);\n        cell.classList.add('revealed');\n        this.revealedCount++;\n        if (this.board[index] === 'm') {\n            cell.classList.add('mine');\n            this.endGame(false);\n        } else if (this.board[index] > 0) {\n            cell.textContent = this.board[index];\n        } else {\n            this.getNeighbors(index).forEach(neighbor => {\n                const neighborCell = this.shadowRoot.querySelector(`[data-index='${neighbor}']`);\n                this.revealCell(neighborCell);\n            });\n        }\n\n        if (!this.gameOver && this.revealedCount === this.rows * this.cols - this.mines) {\n            this.endGame(true);\n        }\n    }\n\n    toggleFlag(cell) {\n        if (this.gameOver || cell.classList.contains('revealed')) return;\n        cell.classList.toggle('flag');\n        cell.textContent = cell.classList.contains('flag') ? '\ud83d\udea9' : '';\n    }\n\n    endGame(win) {\n        this.gameOver = true;\n        if (win) {\n            alert('You win!');\n        } else {\n            alert('You lose!');\n            this.shadowRoot.querySelectorAll('.cell').forEach((cell, index) => {\n                if (this.board[index] === 'm') {\n                    cell.classList.add('mine');\n                }\n            });\n        }\n    }\n}\n\ncustomElements.define('minesweeper-game', MinesweeperGame);\n\ndocument.getElementById('theme-switcher').addEventListener('click', () => {\n    const currentTheme = document.documentElement.getAttribute('data-theme');\n    document.documentElement.setAttribute('data-theme', currentTheme === 'dark' ? 'light' : 'dark');\n});\n\ndocument.getElementById('new-game-btn').addEventListener('click', () => {\n    document.querySelector('minesweeper-game').newGame();\n});\n\ndocument.getElementById('difficulty').addEventListener('change', (e) => {\n    const game = document.querySelector('minesweeper-game');\n    game.setDifficulty(e.target.value);\n    game.newGame();\n});\n